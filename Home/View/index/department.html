<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 新 Bootstrap 核心 CSS 文件 -->
		<link rel="stylesheet" href="/Public/css/bootstrap.min.css">
		<style>
		h3{
			font-family: "黑体" !important;
		}
    .dm-path li{
      cursor: pointer;    
      color: #707070;
    }
    .dm-path .active{
      cursor: auto; 
      color: #D0D0D0;
    }
    .dm-list{
      cursor:pointer;
    }
    .list-group .active{
      background-color: #888888;
      border-color: #707070;
    }
    .list-group .active:hover{
      background-color: #707070;
      border-color: #606060;
    }
    .list-group .active:focus{
      background-color: #888888;
      border-color: #606060;
    }
		</style>
	</head>
<body>
<div class="container">
<block name="content">

<div class="row">
  <div class="col-xs-12">
    <ol class="breadcrumb dm-path" id="dmPath">
    </ol>
  </div>
</div>

<div class="row">
  <div class="col-xs-2 col-sm-3">
    <ul class="list-group dm-list" id="dmList">
<!--     <a class="list-group-item" id="21" onclick="goToDm(21)">人力资源科</a>
    <a class="list-group-item active" id="22" onclick="goToDm(22)">组织科</a>
    <a class="list-group-item" id="23" onclick="goToDm(23)">办公室</a>
    <a class="list-group-item" id="42" onclick="goToDm(42)">五中四科</a> -->
  </ul>
  </div>
  <div class="col-xs-10 col-sm-9">
    <table class="table table-striped table-hover">
      <caption><h4 id="pListTitle">组织科</h4></caption>
      <thead>
        <tr>
          <th scope="row">#</th>
          <th>姓名</th>
          <th>性别</th>
          <th>出生年月</th>
          <th>参加工作时间</th>
          <th>职务</th>
          <th>职务级别</th>
        </tr>
      </thead>
      <tbody id="pList">
        <tr id="p410402190001011234">
          <th scope="row">1</th>
          <td>张三</td>
          <td>男</td>
          <td>1990-01-01</td>
          <td>2000-01-02</td>
          <td>科长</td>
          <td>正科级</td>
        </tr>
        <tr id="p410402190001011235">
          <th scope="row">2</th>
          <td>小红</td>
          <td>女</td>
          <td>1990-01-01</td>
          <td>2000-01-02</td>
          <td>副主任</td>
          <td>正科级</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

  <!-- 单位列表 -->
  </block> <!-- /content block -->
</div><!-- /div container -->



	<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
	<script src="/Public/js/jquery.min.js"></script>
	<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
	<script src="/Public/js/bootstrap.min.js"></script>

  <script type="text/javascript">

  var dmList;
  $("document").ready(function(){
    initial();
  })

  function initial(){
    var txt,rootDm;
    $("#dmPath").text("加载中...");
    $.get("/index.php/Common/getDm/0/0/1",function(rootDm){
      txt = $("<li></li>").text(rootDm["name"]).attr("id",0).addClass("active");
      $("#dmPath").empty().append(txt);
    });
    dmListLoadFrom(0);
  }
  
  function pListLoadFrom(id){
    // 动态加载人员列表框内容
    var data;
    $("#pListTitle").text(dmList[id]["name"]);
    

  }

  function dmListLoadFrom(id){
    //动态加载单位列表
    var dm,key,txt;
    $("#dmList").empty().text("加载中...");
    $.get("/index.php/Common/getDm/"+id+"/1/1",function(dm){
      $("#dmList").empty();
      for(key in dm){
        txt = $("<a></a>")
              .addClass("list-group-item")
              .attr("id",key)
              .text(dm[key]['name'])
              .click(key,function(k){goToDm(k.data)});
        $("#dmList").append(txt);
      }
      // 更新单位列表
      dmList = dm;
    });    
  }

  function backToDm(id){
    $("#dmPath>li#"+id+"~li").remove();
    $("#dmPath>li#"+id).addClass("active").unbind("click");
    dmListLoadFrom(id);
  }

  function goToDm(id){
    var lastPath,lastId,txt,isParent;
    lastPath = $("#dmPath>li:last");
    lastId = $(lastPath).attr("id");
    if(typeof(dmList[id]) != "undefined") isParent = dmList[id]["is_parent"];
    if(isParent == 1){
      //移除当前单位样式，恢复点击跳转
      $(lastPath).removeClass().click(lastId,function(n){backToDm(n.data)});
      //添加新路径为id部门
      txt = $("<li></li>")
            .addClass('active')
            .attr("id",id)
            .text(dmList[id]["name"]);
      $("#dmPath").append(txt);

      dmListLoadFrom(id);
      pListLoadFrom(id);
    }else{
      //不是父部门则更改路径当前位置
      $(lastPath).attr("id",id).text( dmList[id]["name"] );
      // 去掉当前活动部门样式，设置新部门为活动样式
      $("#dmList>a#"+lastId).removeClass().addClass("list-group-item");
      $("#dmList>a#"+id).addClass("active");
      pListLoadFrom(id);
    }
  }
  </script>

</body>
</html>